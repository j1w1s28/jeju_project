<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- <link rel="stylesheet" href="./css/bootstrap.min.css"> -->
    <style>
        .wrap .info {width:320px; height: 110px;}
        .info .body {position: relative; overflow: hidden;}
        .info .title {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; text-align:center; padding: 10px; border-bottom: 1px solid 16px; font-weight:bold;}
        .desc .address {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; margin:10px 5px 5px 5px; text-align:center; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        .desc .phoneno {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; margin:5px 5px 5px 5px; text-align:center; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        .info .close:hover {cursor: pointer;}

        /* ì„ì˜ì˜ ì˜ì—­ ìƒì„± */
        .scrollBar { 
        width: 200px;
        height: 200px;
        overflow-y: scroll;
        }

        /* ì•„ë˜ì˜ ëª¨ë“  ì½”ë“œëŠ” ì˜ì—­::ì½”ë“œë¡œ ì‚¬ìš© */ 

        .scrollBar::-webkit-scrollbar {
            width: 10px;  /* ìŠ¤í¬ë¡¤ë°”ì˜ ë„ˆë¹„ */
        }

        .scrollBar::-webkit-scrollbar-thumb {
            height: 30%; /* ìŠ¤í¬ë¡¤ë°”ì˜ ê¸¸ì´ */
            background: #217af4; /* ìŠ¤í¬ë¡¤ë°”ì˜ ìƒ‰ìƒ */
            
            border-radius: 10px;
        }

        .scrollBar::-webkit-scrollbar-track {
            background: rgba(33, 122, 244, .1);  /*ìŠ¤í¬ë¡¤ë°” ë’· ë°°ê²½ ìƒ‰ìƒ*/
        }
    </style>
    <title>ì œì£¼ë„ ì§€ë„ ğŸ—º</title>
    
</head>
<body>
    <div class="container-fluid" style="padding: 0px;">
            <div class="row">
                <!-- ì¥ì†Œëª… í…Œì´ë¸” -->
                <div class="col-sm-3 scrollBar" style="overflow-x:hidden; overflow-y:scroll; height:700px;">
                    <div class="about_text" >
                        <table class="table table-hover">
                            <tbody>
                                {% for i in range(result[1]) %}
                                    <tr>
                                        <td style="width: 10%;"><a onclick="openwindow(markers[{{ i }}], infowindows[{{ i }}], {{ i }})"><img src={{ result[0][i]["thumbnailpath"] }} height="63" width="65"></a></td>
                                        <th style="width: 60%; vertical-align:middle; word-wrap:break-all"><a onclick="openwindow(markers[{{ i }}], infowindows[{{ i }}], {{ i }})">{{ result[0][i]["title"] }}</a></th>
                                        <td style="width: 30%; vertical-align:middle"><button type="button" class="btn btn-outline-primary btn-sm" id="btnId_{{i}}" onClick="add_btn(this.id)" value="{{ result[0][i] ["title"] }}">ì¶”ê°€</button></td>
                                    </tr>
                                {% endfor %}
                            </tbody> 
                        </table>
                        <script>
                            var add_list = [];
                            var linePath = [];
                            var idChecker = [];
                            var tmpPoly;

                            function add_btn(click_id) {
                                var title = document.querySelector("#"+click_id).value.trim()
                                document.querySelector('#selected_table').innerHTML = ''
                                // ì„  ì§€ìš°ê¸°
                                if(tmpPoly != undefined) {
                                    tmpPoly.setMap(null);
                                }
                                
                                if(document.querySelector("#"+click_id).innerHTML == 'ì¶”ê°€') {
                                    document.querySelector("#"+click_id).innerHTML = "ì„ íƒ";
                                    document.querySelector("#"+click_id).className = 'btn btn-primary btn-sm'
                                    add_list[title] = click_id;
                                    // ì¶”ê°€ì‹œ ìœ„ë„ ê²½ë„ 
                                    x = positions[click_id.split('_')[1]].latlng.Ma;
                                    y = positions[click_id.split('_')[1]].latlng.La;
                                    linePath.push(new kakao.maps.LatLng(x, y));
                                    idChecker.push(click_id);
                                }
                                else{
                                    document.querySelector("#"+click_id).innerHTML = "ì¶”ê°€";
                                    document.querySelector("#"+click_id).className = 'btn btn-outline-primary btn-sm'
                                    let index = idChecker.indexOf(click_id);
                                    delete add_list[title];
                                    // ì¶”ê°€ ì·¨ì†Œ ì‹œ ë°°ì—´ì—ì„œ ë¹¼ê¸°
                                    linePath.splice(index, 1);
                                    idChecker.splice(index, 1);
                                }
                                //ì„  í‘œì‹œ 
                                var polyline = new kakao.maps.Polyline({
                                            path: linePath, // ì„ ì„ êµ¬ì„±í•˜ëŠ” ì¢Œí‘œë°°ì—´ ì…ë‹ˆë‹¤
                                            strokeWeight: 2, // ì„ ì˜ ë‘ê»˜ ì…ë‹ˆë‹¤
                                            strokeColor: '#1478FF', // ì„ ì˜ ìƒ‰ê¹”ì…ë‹ˆë‹¤
                                            strokeOpacity: 0.7, // ì„ ì˜ ë¶ˆíˆ¬ëª…ë„ ì…ë‹ˆë‹¤ 1ì—ì„œ 0 ì‚¬ì´ì˜ ê°’ì´ë©° 0ì— ê°€ê¹Œìš¸ìˆ˜ë¡ íˆ¬ëª…í•©ë‹ˆë‹¤
                                            strokeStyle: 'solid' // ì„ ì˜ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤
                                        });
                                tmpPoly = polyline;
                                polyline.setMap(map);                                      

                                for (var key in add_list) {
                                    document.querySelector('#selected_table').innerHTML += '<tr><tr><td width=10></td><img src="../image/vertical-line.png" height="10" width="10"><td>'+key+'</td></tr></tr>'
                                }
                            }
                        </script>
                    </div>
                </div>

                <!-- ì§€ë„ -->
                <div class="col-sm-7" style="padding: 0px;">
                    <div id="map" style="width:100%;height:700px;"></div> <!--  -->
                    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e60591e1e917a164c421ab8844f09e08"></script>
                    <script>

                    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div  
                        mapOption = { 
                            center: new kakao.maps.LatLng(33.375, 126.55), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
                            level: 10 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
                        };

                    var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                    
                    // ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                    var mapTypeControl = new kakao.maps.MapTypeControl();

                    // ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
                    // kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
                    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

                    // ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
                    var zoomControl = new kakao.maps.ZoomControl();
                    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);

                    // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜ì™€ title ê°ì²´ ë°°ì—´
                    var positions = [];
                    '{% for i in range(result[1]) %}'
                        x = Number('{{result[0][i]["latitude"]}}');
                        y = Number('{{result[0][i]["longitude"]}}');
                        tmp = {
                            title: '{{result[0][i]["title"]}}', 
                            address: '{{result[0][i]["address"]}}',
                            roadaddress:'{{result[0][i]["roadaddress"]}}', 
                            phoneno: '{{result[0][i]["phoneno"]}}', 
                            content : '{{result[0][i]["contentscd"]}}',
                            img_thumb: '{{result[0][i]["thumbnailpath"]}}', 
                            latlng: new kakao.maps.LatLng(x, y)
                        };
                        positions.push(tmp);
                    '{% endfor %}'
                    
                    // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ ì£¼ì†Œ
                    var imageSrc_s = "https://cdn-icons-png.flaticon.com/512/727/727590.png"; //ìˆ™ì†Œ
                    var imageSrc_f =  "https://cdn-icons-png.flaticon.com/512/4108/4108022.png"; //ìŒì‹
                    var imageSrc_p = "https://cdn-icons-png.flaticon.com/512/727/727606.png"; //ê´€ê´‘ì§€

                    // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ í¬ê¸° ì…ë‹ˆë‹¤
                    var imageSize = new kakao.maps.Size(24, 25); 

                    var markers = [];
                    var infowindows = [];

                    
                    // ë§ˆì»¤ ìƒì„±
                    for (var i = 0; i < positions.length; i ++) {
                        
                        // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±
                        if(positions[i].content === "ìˆ™ë°•"){
                            var markerImage = new kakao.maps.MarkerImage(imageSrc_s,imageSize);
                        }else if (positions[i].content === "ìŒì‹ì "){
                            var markerImage = new kakao.maps.MarkerImage(imageSrc_f,imageSize);
                        }else{
                            var markerImage = new kakao.maps.MarkerImage(imageSrc_p,imageSize); 
                        }

                        var marker = new kakao.maps.Marker({
                            map: map, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ì§€ë„
                            position: positions[i].latlng, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜
                            image : markerImage, // ë§ˆì»¤ ì´ë¯¸ì§€ 
                            clickable: true
                        });
                        markers.push(marker);

                        var contents = '<div class="wrap">' + 
                                            '<div class="info">' + 
                                                '<div class="title" id="info_'+i+'">' + positions[i].title +
                                                    '<div class="close" onclick="closeOverlay()" title="ë‹«ê¸°"></div>'+'</div>' + 
                                                    '<div class="body">' +   
                                                        // '<div class="img">' + '<img src='+ positions[i].img + 'width="73" height="70">'+'</div>' + 
                                                        '<div class="desc">' +  
                                                            '<div class="address">' + positions[i].roadaddress.replace(/"/g,'') + '</div>' + 
                                                            '<div class="phoneno">'+ positions[i].phoneno.replace(/"/g,'')+'</div>' +
                                                        '</div>'+
                                                    '</div>' +  
                                                '</div>' + 
                                            '</div>' + 
                                        '</div>',
                            iwRemoveable = true;

                        // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
                        var infowindow = new kakao.maps.InfoWindow({
                            content : contents,
                            removable : iwRemoveable
                        });
                        infowindows.push(infowindow);

                        // ë§ˆì»¤ í´ë¦­í•˜ë©´ ì¸í¬ìœˆë„ìš°
                        kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow, i));
                    }

                    // ë§ˆì»¤ í´ë¦­ ì´ë²¤íŠ¸ //
                    windowChecker = undefined;
                    function makeClickListener(map, marker, infowindow, i) {
                        return function() {
                            // ì´ë™í•  ìœ„ë„ ê²½ë„ ìœ„ì¹˜ ìƒì„±
                            var moveLatLon = new kakao.maps.LatLng(positions[i].latlng.Ma, positions[i].latlng.La);
                            map.setCenter(moveLatLon);
                            // ì§€ë„ ì´ë™
                            map.panTo(moveLatLon);
                            // ì§€ë„ í™•ëŒ€
                            map.setLevel(8);

                            // ì •ë³´ íŒì—…
                            if(windowChecker != undefined) {
                            infowindows[windowChecker].close(map, markers[windowChecker]);
                            }
                            infowindow.open(map, marker);
                            windowChecker = i;

                            // ì¹´í…Œê³ ë¦¬ì— ë”°ë¥¸ íŒì—… ìƒ‰ ë³€ê²½
                            if(positions[i].content == "ìˆ™ë°•" ) {
                                document.querySelector("#info_"+i).style.background = 'rgb(87, 168, 235)'
                            
                            }else if(positions[i].content == "ìŒì‹ì "){
                                document.querySelector("#info_"+i).style.background = '#fc868a'
                                    
                            }else{
                                document.querySelector("#info_"+i).style.background = '#facf4c' //className = 'info title_p'       
                            }
                        };
                    }

                    function openwindow(marker, infowindow, n) {
                        if(windowChecker != undefined) {
                            infowindows[windowChecker].close(map, markers[windowChecker]);
                        }
                        infowindow.open(map, marker);
                        windowChecker = n;
                    }
                    </script>
                </div>

                <!-- ì„ íƒ ì¥ì†Œ í…Œì´ë¸” -->
                <div class="col-sm-2 scrollBar" style="overflow-x:hidden; overflow-y:scroll; height:700px; padding: 5px;">
                    <div class="about_text" >
                        <table class="table">
                            <tbody id="selected_table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
            <!-- <img src='D:/bigdata0214/final_proj/jeju_project/web/image/vertical_line.png'> -->
            <!-- {{result[0][0]}} -->
</body>
</html>