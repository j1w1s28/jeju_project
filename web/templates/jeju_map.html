<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì œì£¼ë„ ì§€ë„ ğŸ—º</title>
    <style>
        /* .wrap {position: absolute;left: 0;bottom: 40px;width: 288px;height: 132px;margin-left: -144px;text-align: left;overflow: hidden;font-size: 12px;font-family: 'Malgun Gothic', dotum, 'ë‹ì›€', sans-serif;line-height: 1.5;}
        .wrap * {padding: 0;margin: 0;} */
        .wrap .info {width:320px; height: 90px;}
        /* .wrap .info:nth-child(1) {border: 0;box-shadow: 0px 1px 2px rgb(116, 148, 229);} */
        /* .info .stay_close {position: absolute;top: 10px;right: 10px;color: #888;width: 17px;height: 17px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png');} */
        /* .info .close:hover {cursor: pointer;} */
        .info .body {position: relative; overflow: hidden;}
        .info .title {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; text-align:center; padding: 10px; border-bottom: 1px solid 16px; font-weight:bold;}
        /* .info .title_s {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; text-align:center; height: 30px; background: rgb(87, 168, 235); border-bottom: 1px solid rgb(33,150,243);font-size: 16px; font-weight:bold;} */
        /* .info .title_f {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; text-align:center; height: 30px; background: #fc868a; border-bottom: 1px solid #ff6167;font-size: 16px;font-weight: bold;} */
        /* .info .title_p {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; text-align:center; height: 30px; background: #facf4c; border-bottom: 1px solid #ffc107;font-size: 15px;font-weight: bold;} */
        /* .stay_info .stay_img {display:inline; top:10px; left:5px; width:90px; height:100px; overflow: hidden;} */
        .desc .address {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; margin:10px 5px 5px 5px; text-align:center; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        .desc .phoneno {font-family: 'Malgun Gothic', dotum, 'ë‹ì›€'; margin:5px 5px 5px 5px; text-align:center; font-size: 13px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}
        .info .close:hover {cursor: pointer;}
    </style>
    
</head>
<body>
    <h1> ì œì£¼ğŸ•ºì œì£¼ğŸ’ƒì œì£¼ğŸ±ì œì£¼ë„ğŸ” </h1>
    <!-- ì§€ë„ ë¶€ë¶„ -->
    <div id="map" style="width:800px; height:500px;"></div>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=1cc07b14640d842cd69b3e2343736a49"></script>
    <script>
    var mapContainer = document.getElementById('map'), // ì§€ë„ë¥¼ í‘œì‹œí•  div  
        mapOption = { 
            center: new kakao.maps.LatLng(33.450701, 126.570667), // ì§€ë„ì˜ ì¤‘ì‹¬ì¢Œí‘œ
            level: 10 // ì§€ë„ì˜ í™•ëŒ€ ë ˆë²¨
        };
    var map = new kakao.maps.Map(mapContainer, mapOption); // ì§€ë„ë¥¼ ìƒì„±í•©ë‹ˆë‹¤

    // ì¼ë°˜ ì§€ë„ì™€ ìŠ¤ì¹´ì´ë·°ë¡œ ì§€ë„ íƒ€ì…ì„ ì „í™˜í•  ìˆ˜ ìˆëŠ” ì§€ë„íƒ€ì… ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
    var mapTypeControl = new kakao.maps.MapTypeControl();

    // ì§€ë„ì— ì»¨íŠ¸ë¡¤ì„ ì¶”ê°€í•´ì•¼ ì§€ë„ìœ„ì— í‘œì‹œë©ë‹ˆë‹¤
    // kakao.maps.ControlPositionì€ ì»¨íŠ¸ë¡¤ì´ í‘œì‹œë  ìœ„ì¹˜ë¥¼ ì •ì˜í•˜ëŠ”ë° TOPRIGHTëŠ” ì˜¤ë¥¸ìª½ ìœ„ë¥¼ ì˜ë¯¸í•©ë‹ˆë‹¤
    map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

    // ì§€ë„ í™•ëŒ€ ì¶•ì†Œë¥¼ ì œì–´í•  ìˆ˜ ìˆëŠ”  ì¤Œ ì»¨íŠ¸ë¡¤ì„ ìƒì„±í•©ë‹ˆë‹¤
    var zoomControl = new kakao.maps.ZoomControl();
    map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT);
    // ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    var positions = [];
        '{% for i in range(result[1])%}'
        x = Number('{{result[0][i]["latitude"]}}');
        y = Number('{{result[0][i]["longitude"]}}');
        tmp= {
            title:'{{result[0][i]["title"]}}',
            address:'{{result[0][i]["address"]}}',
            content : '{{result[0][i]["contentscd"]}}',
            roadaddress:'{{result[0][i]["roadaddress"]}}',
            phoneno:'{{result[0][i]["phoneno"]}}',
            // img: '{{result[0][i]["imgpath"]|tojson}}',
        latlng: new kakao.maps.LatLng(x,y)
        },
        selectedMarker = null;

    positions.push(tmp);
    '{%endfor%}'
   
    // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ ì£¼ì†Œì…ë‹ˆë‹¤
    var imageSrc_s = "https://cdn-icons-png.flaticon.com/512/727/727590.png"; //ìˆ™ì†Œ
    var imageSrc_f =  "https://cdn-icons-png.flaticon.com/512/4108/4108022.png"; //ìŒì‹
    var imageSrc_p = "https://cdn-icons-png.flaticon.com/512/727/727606.png"; //ê´€ê´‘ì§€

    var markers = [];
    var infowindows = [];
    for (var i = 0; i < positions.length; i ++) {
        // ë§ˆì»¤ ì´ë¯¸ì§€ì˜ ì´ë¯¸ì§€ í¬ê¸° ì…ë‹ˆë‹¤
        var imageSize = new kakao.maps.Size(25, 25); 
        // ë§ˆì»¤ ì´ë¯¸ì§€ë¥¼ ìƒì„±í•©ë‹ˆë‹¤ 
        if(positions[i].content === "ìˆ™ë°•"){
            var markerImage = new kakao.maps.MarkerImage(imageSrc_s,imageSize);
        }else if (positions[i].content === "ìŒì‹ì "){
            var markerImage = new kakao.maps.MarkerImage(imageSrc_f,imageSize);
        }else{
            var markerImage = new kakao.maps.MarkerImage(imageSrc_p,imageSize); 
        }
        
        var marker = new kakao.maps.Marker({
            map: map, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ì§€ë„
            position: positions[i].latlng, // ë§ˆì»¤ë¥¼ í‘œì‹œí•  ìœ„ì¹˜
            image : markerImage, // ë§ˆì»¤ ì´ë¯¸ì§€ 
            clickable: true
        });
        markers.push(marker);

        var iwContent = '<div style="padding:5px;"></div>', // ì¸í¬ìœˆë„ìš°ì— í‘œì¶œë  ë‚´ìš©ìœ¼ë¡œ HTML ë¬¸ìì—´ì´ë‚˜ document elementê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
            iwPosition = new kakao.maps.LatLng(33.450701, 126.570667), //ì¸í¬ìœˆë„ìš° í‘œì‹œ ìœ„ì¹˜ì…ë‹ˆë‹¤
            iwRemoveable = true;


        var contents = '<div class="wrap">' + 
                                '<div class="info">' + 
                                    '<div class="title" id="info_'+i+'">' + positions[i].title +
                                        '<div class="close" onclick="closeOverlay()" title="ë‹«ê¸°"></div>'+'</div>' + 
                                        '<div class="body">' +   
                                            // '<div class="img">' + '<img src='+ positions[i].img + 'width="73" height="70">'+'</div>' + 
                                            '<div class="desc">' +  
                                                '<div class="address">' + positions[i].roadaddress.replace(/"/g,'') + '</div>' + 
                                                '<div class="phoneno">'+ positions[i].phoneno.replace(/"/g,'')+'</div>' +
                                            '</div>'+
                                        '</div>' +  
                                    '</div>' + 
                                '</div>' + 
                            '</div>';

        // ì¸í¬ìœˆë„ìš°ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
        var infowindow = new kakao.maps.InfoWindow({
            content : contents,
            removable : iwRemoveable
        });
        infowindows.push(infowindow);

        // ë§ˆì»¤ í´ë¦­í•˜ë©´ ì¸í¬ìœˆë„ìš°
        kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow, i));
        }
        windowChecker = undefined;
        // /marker click event/
        function makeClickListener(map, marker, infowindow, i) {
            return function() {
            var moveLatLng = new kakao.maps.LatLng(positions[i].latlng.Ma, positions[i].latlng.La);   
                map.setCenter(new kakao.maps.LatLng(positions[i].latlng.Ma, positions[i].latlng.La));
                map.panTo(moveLatLng);
                map.setLevel(5);

            if(windowChecker != undefined){
                infowindows[windowChecker].close(map,markers[windowChecker]);
            }
            infowindow.open(map, marker);
            windowChecker = i;
            
            console.log(positions[i].latlng)
            if(positions[i].content == "ìˆ™ë°•" ) {
                document.querySelector("#info_"+i).style.background = 'rgb(87, 168, 235)'
            
            }else if(positions[i].content == "ìŒì‹ì "){
                document.querySelector("#info_"+i).style.background = '#fc868a'
                       
            }else{
                document.querySelector("#info_"+i).style.background = '#facf4c' //className = 'info title_p'       
            }
            
            };
           
        } 
    </script>
   
   
</body>
</html>