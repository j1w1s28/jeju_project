{% extends 'base.html' %}
{% block mapList %}
<!-- Ïø†ÌÇ§ jsÌååÏùº -->
<script src="{{url_for('static',filename='js/cookie.js')}}"></script>
<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e60591e1e917a164c421ab8844f09e08"></script>

<div style="padding: 0; margin: 0 auto 300px;">
    <span id="span_title" style="font-size: 18pt; font-weight: bold; display: block; margin-bottom: 10px"></span>
    <script>
        var region = '{{result[2]}}';
        document.querySelector('#span_title').innerHTML = (region ==  'je' ? 'Ïä§ÎßàÌä∏ÌååÏù∏Îçî - Ï†úÏ£ºÏãúüçä' : 'Ïä§ÎßàÌä∏ÌååÏù∏Îçî - ÏÑúÍ∑ÄÌè¨ÏãúüåÑ');
        // Îç∞Ïù¥ÌÑ∞ Î∞∞Ïó¥
        var food = [];
        var stay = [];
        var place = [];
        
        ('{% for i in range(result[1]) %}');
        x = Number('{{result[0][i]["y"]}}');
        y = Number('{{result[0][i]["x"]}}');
        tmp = {
            id: '{{result[0][i]["id"]}}',
            title: '{{result[0][i]["name"]}}'.replace("amp;","").trim(),
            tag: '{{result[0][i]["keywords"]}}',
            address:  '{{result[0][i]["fullRoadAddress"]}}',
            region : ('{{result[0][i]["fullRoadAddress"]}}'.search("Ï†úÏ£ºÏãú") >= 0 ? "Ï†úÏ£ºÏãú" : "ÏÑúÍ∑ÄÌè¨Ïãú" ),
            phoneno: '{{result[0][i]["phone"]}}',
            content: '{{result[0][i]["contentscd"]}}', 
            description: '{{result[0][i]["description"]}}',
            hourinfo: '{{result[0][i]["bizhourInfo"]}}',
            menus : '{{result[0][i]["menus"]}}'.replace("&#39;","").trim(),
            categories : '{{result[0][i]["categories"]}}',
            menuImg : '{{result[0][i]["menuImages"]}}',
            img_thumb : '{{result[0][i]["imageURL"]}}',
            reviewcnt: '{{result[0][i]["reviewCount"]}}',
            sim_rank1: '{{result[0][i]["sim_rank1"]}}'.replace("amp;",""),
            sim_rank2: '{{result[0][i]["sim_rank2"]}}'.replace("amp;",""),
            sim_rank3: '{{result[0][i]["sim_rank3"]}}'.replace("amp;",""),
            latlng: new kakao.maps.LatLng(x, y),
        };
        ('{% if(result[0][i]["contentscd"] == "ÏùåÏãùÏ†ê") %}');
        food.push(tmp);
        ('{% elif(result[0][i]["contentscd"] == "ÏàôÎ∞ï") %}');
        stay.push(tmp);
        ('{% else  %}');
        place.push(tmp);
        ('{% endif %}');
        ('{% endfor %}');
    </script>

    <!-- Î™®Îã¨ Í¥ÄÎ†® Ìï®Ïàò -->
    <script>
        //Î™®Îã¨ Ïó¥Í∏∞
        function modalOpen(id) {
            modalOff();
            id = '#modal_'+id;
            $(id).addClass("modal_on");
            $(".modal_back").addClass("back_on");
            $("body").addClass("body_lock");
        }
        //Î™®Îã¨ Ï§ëÏïôÏ†ïÎ†¨
        function modalCenter(){
                var modal_w = $(".modal").width()/2;
                $(".modal").css("margin-left", -modal_w);
                var modal_h = $(".modal").height()/2;
                $(".modal").css("margin-top", -modal_h);
        }
        //Î™®Îã¨ ÎÅÑÍ∏∞
        function modalOff(){
            $(".modal").removeClass("modal_on");
            $(".modal_back").removeClass("back_on");
            $("body").removeClass("body_lock");
        }
        //Î™®Îã¨ Ï†ïÎ¶¨ Ïä§ÌÅ¨Î¶ΩÌä∏
        function modalClean() {
            $(window).resize(function(){
                modalCenter();
            });
            $(".modal_x").click(function(id){
                modalOff();
            });
            $(".modal_back").click(function(id){
                modalOff();
            });
            modalCenter();
        }
    </script>

    <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Î≥ÄÍ≤Ω Î°úÎî© Ïä§ÌÅ¨Î¶ΩÌä∏ -->
    <script>
        function loading() {
            $('.category_back').addClass('category_back_on');
            $('body').addClass('body_lock');
            setTimeout(() => {
                createMarker();
                $('.category_back').removeClass('category_back_on');
                $('body').removeClass('body_lock');
            }, 100);
        }
    </script>

    <!-- Ïû•ÏÜåÎ™Ö ÌÖåÏù¥Î∏î -->
    <div class="scrollBar" style="overflow-x: hidden; overflow-y: scroll; height: 630px; width: 345px; background-color: #fff; border-radius: 10px; position: absolute">
        <div class="about_text">
            <table class="table table-hover">
                <tbody id="jeju_list" style="border-radius: 10px"></tbody>
            </table>
            <script>
                // getCookie - Ï∞úÎ™©Î°ù
                var add_list = [];
                const is_list = getCookie("addlist");
                if(is_list != null) {
                    var tmpList = is_list.split("//")
                    tmpList.pop()
                    for(var i of tmpList){
                        var tmpList2 = i.split(":");
                        var key = tmpList2[0].replace(",",'');
                        var val = tmpList2[1].split(",");
                        add_list[key] = val;
                    }
                }

                // getCookie - Ï∞úÎ™©Î°ù Í≤ΩÎ°ú
                var linePath = [];
                const is_line = getCookie("addline");
                if(is_line != null) {
                    var tmpList = is_line.split("//")
                    tmpList.pop()
                    for(var i of tmpList){
                        x = i.split(",")[0];
                        y = i.split(",")[1];
                        linePath.push(new kakao.maps.LatLng(x, y));
                    }
                }

                // Ï∞ú Ïû•ÏÜå Ï∂îÍ∞Ä Ìï®Ïàò (Ïò§Î•∏Ï™Ω)
                function addSelected(add_list){
                    for (var key in add_list) {
                            var selected =  '<div class="col-2" style="margin-top:10px;margin-bottom:5px">'+
                                            (food.findIndex((element) => element.title === key) >= 0
                                                ? '<img src="{{ url_for("static", filename="img/circle_r.png")}}" height=25 width="25">'
                                                : (place.findIndex((element) => element.title === key) >= 0
                                                    ? '<img src="{{ url_for("static", filename="img/circle_y.png")}}" height=25 width="25">'
                                                    : '<img src="{{ url_for("static", filename="img/circle_b.png")}}" height=25 width="25">'))
                                                +
                                            '</div>'+
                                            '<div class="col" onclick="document.querySelector(\'#List'+add_list[key].slice(-1)[0]+'\').click()" style="width: 180; margin-top:10px;margin-bottom:5px;word-break:break-all;"><b>'+ key +'</b></div>'+
                                            '<div class="w-100"></div>'+
                                            '<div class="col-2" style="margin-top:5px;margin-bottom:5px"><img src="{{ url_for("static", filename="img/line_b.png")}}" height=100% width="25" style="opacity: 0.7"></div>'+
                                            '<div class="col" style="font-size:13px; margin-top:5px; margin-bottom:5px; width: 180px; table-layout:fixed;">'+ add_list[key].slice(0,-1) +'<br></div>'+
                                            '<div class="w-100"></div>'
                            document.querySelector('#selected_title').innerHTML += selected
                        }
                }

                // ÏßÄÎèÑ ÏÑ† ÏÉùÏÑ± Ìï®Ïàò
                var tmpPoly;
                function createLine(linePath){
                    var polyline = new kakao.maps.Polyline({
                        path: linePath, // ÏÑ†ÏùÑ Íµ¨ÏÑ±ÌïòÎäî Ï¢åÌëúÎ∞∞Ïó¥ ÏûÖÎãàÎã§
                        strokeWeight: 2, // ÏÑ†Ïùò ÎëêÍªò ÏûÖÎãàÎã§
                        strokeColor: '#1478FF', // ÏÑ†Ïùò ÏÉâÍπîÏûÖÎãàÎã§
                        strokeOpacity: 0.7, // ÏÑ†Ïùò Î∂àÌà¨Î™ÖÎèÑ ÏûÖÎãàÎã§ 1ÏóêÏÑú 0 ÏÇ¨Ïù¥Ïùò Í∞íÏù¥Î©∞ 0Ïóê Í∞ÄÍπåÏö∏ÏàòÎ°ù Ìà¨Î™ÖÌï©ÎãàÎã§
                        strokeStyle: 'solid' // ÏÑ†Ïùò Ïä§ÌÉÄÏùºÏûÖÎãàÎã§
                    });
                    tmpPoly = polyline;
                    polyline.setMap(map);
                }
                
                // Ï∞úÌïòÍ∏∞ ÌÅ¥Î¶≠ Ìï®Ïàò
                var idChecker = [];
                var selectedMarker = [];
                function addBtn(click_id) {
                    var title = document.querySelector("#"+click_id).value;
                    var tag = positions.find(x => x.id === click_id.split('_')[1]).tag.split(',').slice(0,5);
                    document.querySelector('#selected_title').innerHTML = '';
                    // ÏÑ† ÏßÄÏö∞Í∏∞
                    if(tmpPoly != undefined) {
                        tmpPoly.setMap(null);
                    }

                    // Î≤ÑÌäº ÏÉÅÌÉú Î≥ÄÍ≤Ω
                    if(document.querySelector("#"+click_id).checked) {
                        document.querySelector("#"+click_id).checked = true;
                        if(document.querySelector("#Info"+click_id)!=null){
                            document.querySelector("#Info"+click_id).checked = true;
                        }
                        add_list[title] = tag;
                        add_list[title].push(click_id);

                        // Ï∂îÍ∞ÄÏãú ÏúÑÎèÑ Í≤ΩÎèÑ
                        x = positions.find(x => x.id === click_id.split('_')[1]).latlng.Ma;
                        y = positions.find(x => x.id === click_id.split('_')[1]).latlng.La;
                        linePath.push(new kakao.maps.LatLng(x, y));
                        idChecker.push(click_id);
                    }
                    else {
                        document.querySelector("#"+click_id).checked = false;
                        if(document.querySelector("#Info"+click_id)!=null){
                            document.querySelector("#Info"+click_id).checked = false;
                        }
                        delete add_list[title];
                        let index = idChecker.indexOf(click_id);
                        // Ï∂îÍ∞Ä Ï∑®ÏÜå Ïãú Î∞∞Ïó¥ÏóêÏÑú ÎπºÍ∏∞
                        linePath.splice(index, 1);
                        idChecker.splice(index, 1);
                    }

                    createLine(linePath)
                    addSelected(add_list);
                    
                    // Cookie Ï†ÄÏû• - Ï∞úÎ¶¨Ïä§Ìä∏
                    var value = "";
                    for (var i in add_list){
                        if(value != "") value += ",";
                        value += i+":"+add_list[i]+"//";
                    }
                    setCookie("addlist", value, 1)

                    // Cookie Ï†ÄÏû• - ÎùºÏù∏ Î¶¨Ïä§Ìä∏
                    var val_line = "";
                    for (var i of linePath){
                        val_line += i['Ma'] + "," + i['La'] +"//";
                    }
                    setCookie("addline", val_line, 1)
                }

                // Ïù∏Ìè¨Ï∞ΩÏóêÏÑú ÌïòÌä∏(Ï∞ú) ÌÅ¥Î¶≠Ïãú Ìï®Ïàò
                function addInfoBtn(Info_click_id){
                    click_id = Info_click_id.replace("Info","")
                    if(document.querySelector("#"+Info_click_id).checked) {
                        document.querySelector("#"+click_id).checked=true;
                    }
                    else {
                        document.querySelector("#"+click_id).checked=false;
                    }
                    addBtn(click_id);
                }
            </script>
        </div>
    </div>

    <!-- ÏßÄÎèÑ -->
    <div>
        <div id="map" style="width: 690px; height: 630px; border-radius: 10px; position: absolute; margin-left: 355px">
            <!-- ÏßÄÎèÑ ÏúÑÏóê ÌëúÏãúÎê† ÎßàÏª§ Ïπ¥ÌÖåÍ≥†Î¶¨ -->
            <div class="category btn-group opacity-85" role="group" aria-label="Basic checkbox toggle button group">
                <input type="checkbox" class="btn-check" id="category1" autocomplete="off" value="ÏùåÏãùÏ†ê" onclick="clickCategory(document.getElementById('inputGroupRegion').value)" />
                <label class="btn btn-outline-danger" for="category1">üçî<br/>ÏùåÏãùÏ†ê</label>

                <input type="checkbox" class="btn-check" id="category2" autocomplete="off" value="Í¥ÄÍ¥ëÏßÄ" onclick="clickCategory(document.getElementById('inputGroupRegion').value)" checked />
                <label class="btn btn-outline-warning" for="category2">üé°<br/>Í¥ÄÍ¥ëÏßÄ</label>

                <input type="checkbox" class="btn-check" id="category3" autocomplete="off" value="ÏàôÎ∞ï" onclick="clickCategory(document.getElementById('inputGroupRegion').value)" checked />
                <label class="btn btn-outline-primary" for="category3">üè†<br/>ÏàôÎ∞ï</label>
            </div>
            <!-- ÏßÄÎèÑ ÏßÄÏó≠ ÎìúÎ°≠Îã§Ïö¥ -->
                <div class="input-group mb-3" style="z-index: 2; top: 10px; width: 140px; left: 542px;">
                    <select class="form-select" name="order_status" id="inputGroupRegion">
                        <option value="Ï†úÏ£ºÎèÑ">üèùÏ†úÏ£ºÎèÑ</option>
                        <option value="Ï†úÏ£ºÏãú" id="status1">üçäÏ†úÏ£ºÏãú</option>
                        <option value="ÏÑúÍ∑ÄÌè¨Ïãú" id="status2">&#127748;ÏÑúÍ∑ÄÌè¨Ïãú</option>
                    </select>
                </div>
        </div>

        <script>
            region == 'je' ? document.querySelector('#status1').selected=true : document.querySelector('#status2').selected=true;
            document.getElementById("inputGroupRegion").addEventListener("change", function() {
                if(document.getElementById("inputGroupRegion").value === "Ï†úÏ£ºÏãú") {
                    region="Ï†úÏ£ºÏãú";
                    document.querySelector('#span_title').innerHTML = 'Ïä§ÎßàÌä∏ÌååÏù∏Îçî - Ï†úÏ£ºÏãúüçä';
                }
                else if(document.getElementById("inputGroupRegion").value === "ÏÑúÍ∑ÄÌè¨Ïãú") {
                    region="ÏÑúÍ∑ÄÌè¨Ïãú";
                    document.querySelector('#span_title').innerHTML = 'Ïä§ÎßàÌä∏ÌååÏù∏Îçî - ÏÑúÍ∑ÄÌè¨ÏãúüåÑ';
                }
                else  {
                    region="Ï†úÏ£ºÎèÑ";
                    document.querySelector('#span_title').innerHTML = 'Ïä§ÎßàÌä∏ÌååÏù∏Îçî - Ï†úÏ£ºÎèÑüèù';
                }
                map.setCenter(new kakao.maps.LatLng(33.375, 126.55));
                map.setLevel(10);
                if(windowChecker != undefined){
                    infoClose();
                    windowChecker = undefined;
                }

                for(var i in add_list) {
                    if(positions.findIndex((element) => element.title === i) >= 0){
                        document.querySelector('#'+add_list[i].slice(-1)[0]).checked = false;
                    }
                }
                document.querySelector('#selected_title').innerHTML = "";
                deleteCookie("addlist");
                deleteCookie("addline");
                add_list = [];
                linePath = [];
                idChecker=[];
                tmpPoly.setMap(null);
                if(windowChecker != undefined){
                    infoClose();
                    windowChecker = undefined;
                }
                
                clickCategory(region);
                
            });

            var mapContainer = document.getElementById('map'), // ÏßÄÎèÑÎ•º ÌëúÏãúÌï† div
                mapOption = {
                    center: new kakao.maps.LatLng(33.375, 126.55), // ÌïúÎùºÏÇ∞ Ï¢åÌëú
                    level: 10, // ÏßÄÎèÑÏùò ÌôïÎåÄ Î†àÎ≤®
                };

            var map = new kakao.maps.Map(mapContainer, mapOption); // ÏßÄÎèÑÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§
            // map.setMaxLevel(10);
            // map.setBounds((33.27468472204246, 125.97603087677453), (34.04423387381139, 127.39200174133641)); // ÏßÄÎèÑ Ïù¥Îèô Î≤îÏúÑ Ï†úÌïú

            // ÏùºÎ∞ò ÏßÄÎèÑÏôÄ Ïä§Ïπ¥Ïù¥Î∑∞Î°ú ÏßÄÎèÑ ÌÉÄÏûÖÏùÑ Ï†ÑÌôòÌï† Ïàò ÏûàÎäî ÏßÄÎèÑÌÉÄÏûÖ Ïª®Ìä∏Î°§ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§
            // var mapTypeControl = new kakao.maps.MapTypeControl();
            // map.addControl(mapTypeControl, kakao.maps.ControlPosition.TOPRIGHT);

            // ÏßÄÎèÑ ÌôïÎåÄ Ï∂ïÏÜåÎ•º Ï†úÏñ¥Ìï† Ïàò ÏûàÎäî  Ï§å Ïª®Ìä∏Î°§ÏùÑ ÏÉùÏÑ±Ìï©ÎãàÎã§
            // var zoomControl = new kakao.maps.ZoomControl();
            // map.addControl(zoomControl, kakao.maps.ControlPosition.RIGHT)
            

            // Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº ÌÅ¥Î¶≠ Ìï®Ïàò
            var positions = [];
            var checker = [];
            windowChecker = undefined;
            function clickCategory(region) {
                if(windowChecker != undefined){
                    infoClose();
                    windowChecker = undefined
                }
                positions = [];
                delLocation(checker);
                if (document.querySelector('#category1').checked) {
                    positions = positions.concat(food);
                }
                if (document.querySelector('#category2').checked) {
                    positions = positions.concat(place);
                }
                if (document.querySelector('#category3').checked) {
                    positions = positions.concat(stay);
                }

                if (region != 'Ï†úÏ£ºÎèÑ'){
                    positions=positions.filter(function(obj) {return (obj.region === region);})
                }
                
                // Î°úÎî©Ï∞Ω ON/OFF (ÎÇ¥Î∂ÄÏóê createMarkerÌï®Ïàò Ìè¨Ìï®)
                loading();

                //Î™®Îã¨ Ïû¨Ï†ïÎ¶¨
                modalClean();
            }

            // ÎßàÏª§ ÏÇ≠Ï†ú Ìï®Ïàò
            function delLocation(Loc) {
                for (let i = 0; i < Loc.length; i++) {
                    Loc[i].setMap(null);
                }
            }

            // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ Ï£ºÏÜå
            var imageSrc_s = 'https://cdn-icons-png.flaticon.com/512/727/727590.png'; //ÏàôÏÜå
            var imageSrc_f = 'https://cdn-icons-png.flaticon.com/512/4108/4108022.png'; //ÏùåÏãù
            var imageSrc_p = 'https://cdn-icons-png.flaticon.com/512/727/727606.png'; //Í¥ÄÍ¥ëÏßÄ

            // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ ÌÅ¨Í∏∞
            var imageSize = new kakao.maps.Size(24, 25);
            
            // ÎßàÏª§, Î¶¨Ïä§Ìä∏ ÏÉùÏÑ± Ìï®Ïàò
            var infowindows = [];
            var markers = [];
            function createMarker() {
                infowindows = [];
                markers = [];
                document.querySelector('#jeju_list').innerHTML = '';
                
                // ÎßàÏª§ ÏÉùÏÑ±
                for (var i = 0; i < positions.length; i++) {
                    // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄÎ•º ÏÉùÏÑ±
                    if (positions[i].content === 'ÏàôÎ∞ï') {
                        var markerImage = new kakao.maps.MarkerImage(imageSrc_s, imageSize);
                    } else if (positions[i].content === 'ÏùåÏãùÏ†ê') {
                        var markerImage = new kakao.maps.MarkerImage(imageSrc_f, imageSize);
                    } else {
                        var markerImage = new kakao.maps.MarkerImage(imageSrc_p, imageSize);
                    }

                    var marker = new kakao.maps.Marker({
                        map: map, // ÎßàÏª§Î•º ÌëúÏãúÌï† ÏßÄÎèÑ
                        position: positions[i].latlng, // ÎßàÏª§Î•º ÌëúÏãúÌï† ÏúÑÏπò
                        image: markerImage, // ÎßàÏª§ Ïù¥ÎØ∏ÏßÄ
                        clickable: true,
                    });
                    markers.push(marker);
                    checker.push(marker);

                    var contents =
                        '<div class="wrap">' +
                            '<div class="info"">' +
                                '<div class="title" id="info_' + positions[i].id + '">'+
                                    '<div style="position: absolute; height: 17px; "><img src="https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/overlay_close.png" style="padding-bottom: 3px; margin-left:280px" onclick="infoClose();"></div>' +
                                    positions[i].title +
                                '</div>' +
                                '<div class="body">' +
                                    // '<div class="img">' + '<img src='+ positions[i].img + 'width="73" height="70">'+'</div>' +
                                    '<div class="desc">' +
                                        '<div class="address">' + positions[i].address.replace(/"/g, '') + '</div>' +
                                        '<div class="phoneno">' + positions[i].phoneno.replace(/"/g, '') + '</div>' +
                                        '<div class="phoneno">' +
                                            '<label class="heart-switch">' +
                                                '<input type="checkbox" id="InfobtnId_' +  positions[i].id + '" onClick="addInfoBtn(this.id)"' + (positions[i]['title'] in add_list ? 'checked' : '')  + '>' +
                                                '<svg viewBox="0 0 33 23" fill="white">' +
                                                    '<path d="M23.5,0.5 C28.4705627,0.5 32.5,4.52943725 32.5,9.5 C32.5,16.9484448 21.46672,22.5 16.5,22.5 C11.53328,22.5 0.5,16.9484448 0.5,9.5 C0.5,4.52952206 4.52943725,0.5 9.5,0.5 C12.3277083,0.5 14.8508336,1.80407476 16.5007741,3.84362242 C18.1491664,1.80407476 20.6722917,0.5 23.5,0.5 Z"></path>' +
                                                '</svg>' +
                                            '</label>' +
                                        '</div>' +
                                    '</div>' +
                                '</div>' +
                            '</div>' +
                        '</div>';

                    // Ïù∏Ìè¨ÏúàÎèÑÏö∞Î•º ÏÉùÏÑ±Ìï©ÎãàÎã§
                    var infowindow = new kakao.maps.InfoWindow({
                        content: contents,
                    });
                    infowindows.push(infowindow);

                    // ÎßàÏª§ ÌÅ¥Î¶≠ÌïòÎ©¥ Ïù∏Ìè¨ÏúàÎèÑÏö∞
                    kakao.maps.event.addListener(marker, 'click', makeClickListener(map, marker, infowindow, i, positions[i].id));
                    
                    // Ïù¥ÎØ∏ÏßÄ ÏóÜÎäîÎÜàÎì§ Í∑§Î°ú ÎßåÎì§Ïñ¥Î≤ÑÎ¶¨Í∏∞
                    let img;
                    if (positions[i]['img_thumb'] == 'None') {
                        img = '../static/img/orange.png';
                    } else {
                        img = positions[i]['img_thumb'];
                    }
                    let imgSrc = '<div class="modal_img"><img src="'+img+'" style="border-radius: 100px; width: 200px; height: 200px; "></div><br>';

                    // Ï†úÏ£ºÎèÑ Î¶¨Ïä§Ìä∏ Ï∂îÍ∞Ä(ÏôºÏ™Ω)
                    var jejuList =
                        '<tr id="trId_'+positions[i].id+'">' + 
                            '<td><a onclick="openwindow(markers[' + i + '], infowindows[' + i + '], ' + i + ', '+ positions[i].id+')"><img src="' + img + '" height="63" width="65" style="border-radius: 50px;"></a></td>' +
                            '<td style="vertical-align:middle; word-break:break-all; width: 226px; table-layout:fixed; ">'+
                                '<a id="ListbtnId_'+positions[i].id+'" onclick="openwindow(markers[' + i + '], infowindows[' + i + '], ' + i + ', '+ positions[i].id+')">' + positions[i]['title'] + '</a></td>' +
                            '<td style="vertical-align:middle; padding-right: 0px;">' +
                                '<label class="heart-switch">' +
                                    '<input type="checkbox" id="btnId_' +  positions[i].id + '" onClick="addBtn(this.id)" value="' + positions[i]['title'] + '"' + (positions[i]['title'] in add_list ? 'checked' : '') + '>' +
                                    '<svg viewBox="0 0 33 23" fill="white">' +
                                        '<path d="M23.5,0.5 C28.4705627,0.5 32.5,4.52943725 32.5,9.5 C32.5,16.9484448 21.46672,22.5 16.5,22.5 C11.53328,22.5 0.5,16.9484448 0.5,9.5 C0.5,4.52952206 4.52943725,0.5 9.5,0.5 C12.3277083,0.5 14.8508336,1.80407476 16.5007741,3.84362242 C18.1491664,1.80407476 20.6722917,0.5 23.5,0.5 Z"></path>' +
                                    '</svg>' +
                                '</label>' +
                            '</td>' +
                            '<td><a class="btnM" data-toggle="modal" onclick="modalOpen('+i+');">üîç</a>'+
                            // ÏàôÎ∞ï
                            ( positions[i].content ==='ÏàôÎ∞ï'
                            ?'<div class="modal" id="modal_'+i+'">'+
                            '<div class="modal_x">Îã´Í∏∞</div>'+
                            '<div class="modal_text">'+
                            '<p class="modal_t">'+positions[i].title+'</p>'+
                            imgSrc+'</div>'+
                            '<div class="modal_span">üè† '+positions[i].categories+'<br>' +'üè† '+positions[i].address+'<br>'+'üìû '+positions[i].phoneno+'<br>‚è∞ '+positions[i].hourinfo.replaceAll("|","<br>")+'<br><a href="'+positions[i].menuImg+'" target="_blank">üìÑ ÏàôÏÜå ÏòàÏïΩÌïòÍ∏∞</a></div><hr>'+
                            '<div class="modal_info">üìù</div>'+
                            '<div class="modal_info" style="text-align:left;">'+positions[i].description.replaceAll("|","<br>")+'</div>'+
                            '</div>'
                            // ÏùåÏãùÏ†ê
                            :( positions[i].content === 'ÏùåÏãùÏ†ê'
                            ?'<div class="modal" id="modal_'+i+'">'+
                            '<div class="modal_x">Îã´Í∏∞</div>'+
                            '<div class="modal_text">'+
                            '<p class="modal_t">'+positions[i].title+'</p>'+
                            imgSrc+'</div>'+
                            '<div class="modal_span">üçΩ '+positions[i].categories+'<br>' +'üè† '+positions[i].address+'<br>'+'üìû '+positions[i].phoneno+'<br>'+'‚è∞<br>'+positions[i].hourinfo.replaceAll("|","<br>")+'</div>'+
                                '<div class="modal_info">'+
                                    '<div class="accordion" id="accordion'+i+'">'+
                                        '<div class="accordion-item">' +
                                            '<h2 class="accordion-header" id="heading'+i+'">'+
                                            '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse'+i+'" aria-expanded="false" aria-controls="collapse'+i+'" style="padding-left:40%">' +
                                                'üçΩÎ©îÎâ¥üçΩ'+
                                            '</button>' +
                                            '</h2>' +
                                            '<div id="collapse'+i+'" class="accordion-collapse collapse" aria-labelledby="heading'+i+'" data-bs-parent="#accordion">' +
                                                '<div class="accordion-body">'+
                                                    positions[i].menus.replaceAll("/","<br>")+
                                                    '<a href="'+positions[i].menuImg+'" target="_blank">üìÑ Î©îÎâ¥Ïù¥ÎØ∏ÏßÄÎ≥¥Í∏∞</a>'+
                                                '</div>' +
                                            '</div>' +
                                        '</div>' + 
                                    '</div><br>'+
                                    '<div>'+
                                        '<div>Ïú†ÏÇ¨Ìïú ÎßõÏßëüçΩ</div>'+
                                        '<div id="simId'+i+'" class="simClass"></div>'+
                                    '</div>'+
                                '</div>'+
                            '</div>'
                            // Í¥ÄÍ¥ëÏßÄ
                            :'<div class="modal" id="modal_'+i+'">'+
                            '<div class="modal_x">Îã´Í∏∞</div>'+
                            '<div class="modal_text">'+
                            '<p class="modal_t">'+positions[i].title+'</p>'+
                            imgSrc+'</div>'+
                            '<div class="modal_span">üé° '+positions[i].categories+'<br>' +'üè† '+positions[i].address+'<br>'+'üìû '+positions[i].phoneno+'<br>'+'‚è∞<br>'+positions[i].hourinfo.replaceAll("|","<br>")+'</div>'+
                            '<div class="modal_info">'+
                                    '<div class="accordion" id="accordion'+i+'">'+
                                        '<div class="accordion-item">' +
                                            '<h2 class="accordion-header" id="heading'+i+'">'+
                                            '<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse'+i+'" aria-expanded="false" aria-controls="collapse'+i+'" style="padding-left:35%">' +
                                                'üíµ ÏûÖÏû•Î£å üí≥'+
                                            '</button>' +
                                            '</h2>' +
                                            '<div id="collapse'+i+'" class="accordion-collapse collapse" aria-labelledby="heading'+i+'" data-bs-parent="#accordion">' +
                                                '<div class="accordion-body">'+
                                                    positions[i].menus.replaceAll("/","<br>")+
                                                '</div>' +
                                            '</div>' +
                                        '</div>' + 
                                    '</div><br>'+
                                    '<div class="modal_info" style="text-align:left;">'+positions[i].description.replaceAll("|","<br>")+'</div>'+
                                '</div>'+
                            '</div>')
                            )+
                            '</td>'+
                            '</tr>';

                            
                        document.querySelector('#jeju_list').innerHTML += jejuList;
                        if(document.querySelector('#simId'+i) != null) {
                            for(let j=1; j<4; j++){
                                let sim = positions[i]["sim_rank"+j];
                                if(sim != "None" & sim != ""){
                                    let simText = '<a href="https://map.naver.com/v5/smart-around/place/'+sim.split(",")[2]+'" target="_blank" style="color:black"><div class="simInnerDIV">'+
                                        '<img class="simInnerImg" src="'+(sim.split(",")[1]!="" ? sim.split(",")[1] : '../static/img/orange.png')+'"><br>'+
                                        '<span class="simInnerText">'+sim.split(",")[0]+'</span>'+
                                        '</div></a>';
                                    document.querySelector('#simId'+i).innerHTML += simText;
                                }
                                else{
                                    if(j==1){
                                        document.querySelector('#simId'+i).innerHTML += "ÏïÑÏßÅ Ïú†ÏÇ¨Ìïú ÎßõÏßëÏù¥ ÏóÜÏñ¥ÏöîüòÇ";
                                    }
                                    break;
                                }
                            }
                        }
                    }
            }


            function infoClose() {
                infowindows[windowChecker].close(map, markers[windowChecker]);
                circle.setMap(null);
            }

            function infoColor(i, map, marker) {
                // Ïπ¥ÌÖåÍ≥†Î¶¨Ïóê Îî∞Î•∏ ÌåùÏóÖ ÏÉâ Î≥ÄÍ≤Ω
                if (positions[i].content == 'ÏàôÎ∞ï') {
                    document.querySelector('#info_' +  positions[i].id).style.background = '#57A8EB';
                } else if (positions[i].content == 'ÏùåÏãùÏ†ê') {
                    document.querySelector('#info_' +  positions[i].id).style.background = '#fc868a';
                } else {
                    document.querySelector('#info_' +  positions[i].id).style.background = '#facf4c';
                }
            }

            // ÎßàÏª§ ÌÅ¥Î¶≠ Ïù¥Î≤§Ìä∏ //
            var circle = new kakao.maps.Circle({});
            function makeClickListener(map, marker, infowindow, i, id) {
                return function () {
                    var moveLatLon = positions[i].latlng;
                    moveAndCircle(moveLatLon);

                    // Ï†ïÎ≥¥ ÌåùÏóÖ
                    if (windowChecker != undefined) {
                        infowindows[windowChecker].close(map, markers[windowChecker]);
                    }
                    infowindow.open(map, marker);
                    infoColor(i, map, marker);
                    windowChecker = i;

                    if(document.querySelector("#btnId_"+id).value in add_list){
                        document.querySelector("#InfobtnId_"+id).checked=true;
                    }
                    else {
                        document.querySelector("#InfobtnId_"+id).checked=false;
                    }
                };
            }

            function openwindow(marker, infowindow, i, id) {
                // Ïù¥ÎèôÌï† ÏúÑÎèÑ Í≤ΩÎèÑ ÏúÑÏπò ÏÉùÏÑ±
                var moveLatLon = positions[i].latlng;
                moveAndCircle(moveLatLon);

                if (windowChecker != undefined) {
                    infowindows[windowChecker].close(map, markers[windowChecker]);
                }
                infowindow.open(map, marker);
                infoColor(i);
                if(document.querySelector("#btnId_"+id).value in add_list){
                    document.querySelector("#InfobtnId_"+id).checked=true;
                }
                else {
                    document.querySelector("#InfobtnId_"+id).checked=false;
                }
                windowChecker = i;
            }

            function moveAndCircle(moveLatLon) {
                // ÏßÄÎèÑ Ïù¥Îèô
                map.setCenter(moveLatLon);
                // map.panTo(moveLatLon);

                // ÏßÄÎèÑ ÌôïÎåÄ
                map.setLevel(7);
                // ÏßÄÎèÑÏóê ÌëúÏãúÌï† ÏõêÏùÑ ÏÉùÏÑ±, ÌëúÏãú
                circle.setMap(null); // Í∏∞Ï°¥ Ïõê Ï¥àÍ∏∞Ìôî
                circle = new kakao.maps.Circle({
                    center: moveLatLon, // ÏõêÏùò Ï§ëÏã¨Ï¢åÌëú ÏûÖÎãàÎã§
                    radius: 5000, // ÎØ∏ÌÑ∞ Îã®ÏúÑÏùò ÏõêÏùò Î∞òÏßÄÎ¶ÑÏûÖÎãàÎã§
                    strokeWeight: 1, // ÏÑ†Ïùò ÎëêÍªòÏûÖÎãàÎã§
                    strokeColor: '#75B8FA', // ÏÑ†Ïùò ÏÉâÍπîÏûÖÎãàÎã§
                    strokeOpacity: 0.5, // ÏÑ†Ïùò Î∂àÌà¨Î™ÖÎèÑ ÏûÖÎãàÎã§ 1ÏóêÏÑú 0 ÏÇ¨Ïù¥Ïùò Í∞íÏù¥Î©∞ 0Ïóê Í∞ÄÍπåÏö∏ÏàòÎ°ù Ìà¨Î™ÖÌï©ÎãàÎã§
                    fillColor: '#CFE7FF', // Ï±ÑÏö∞Í∏∞ ÏÉâÍπîÏûÖÎãàÎã§
                    fillOpacity: 0.5, // Ï±ÑÏö∞Í∏∞ Î∂àÌà¨Î™ÖÎèÑ ÏûÖÎãàÎã§
                });
                circle.setMap(map);
            }
        </script>
    </div>

    <!-- ÏÑ†ÌÉù Ïû•ÏÜå div -->
    <div style="width: 345px; height: 630px; margin-left: 1055px">
        <div class="scrollBar" style="width: 100%; overflow-x: hidden; overflow-y: scroll; height: 580px; padding: 5px; background-color: #fff; border-radius: 10px">
            <div class="row" id="selected_title"></div>
        </div>
        <div class="d-grid gap-2" style="margin-top: 10px; padding-right: 10px">
            <button class="btn btn-primary" type="button" onclick="resetAll()">Ï¥àÍ∏∞Ìôî</button>
            <script>
                function resetAll() {
                    if (window.confirm('Ï¥àÍ∏∞Ìôî ÌïòÏãúÍ≤†ÏäµÎãàÍπå?')) {
                        for(var i in add_list) {
                            if(positions.findIndex((element) => element.title === i) >= 0){
                                document.querySelector('#'+add_list[i].slice(-1)[0]).checked = false;
                            }
                        }
                        document.querySelector('#selected_title').innerHTML = "";
                        deleteCookie("addlist");
                        deleteCookie("addline");
                        add_list = [];
                        linePath = [];
                        idChecker=[];
                        tmpPoly.setMap(null);
                        if(windowChecker != undefined){
                            infoClose();
                            windowChecker = undefined;
                        }
                        // window.location.reload(); // ÏÉàÎ°úÍ≥†Ïπ®
                    }
                }
            </script>
        </div>
    </div>
</div>
<div class="modal_back"></div>
<div class="category_back">
    <img style="width: 128px;" src="../static/img/loadingBook.gif" alt="loadingBook"> <br>
    <span class="loadingText" style="color: #000; font-size: 20pt;">Ïû•ÏÜå Í≤ÄÏÉâ Ï§ë</span>
</div>

<!-- getCookie -->
<script>
    document.getElementById('category1').click();
    addSelected(add_list)
    createLine(linePath)
</script>

<!-- GraphÍ≥µÍ∞Ñ -->
{% block graph %}
{% endblock %}

{% endblock %}